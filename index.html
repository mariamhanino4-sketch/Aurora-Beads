<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aurora Beads ‚ú® - UMKM System</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <!-- Firebase SDK versi 9 modular -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, where, orderBy, getDocs, serverTimestamp, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC1obR7WQlxcySONU1yua86fiN12Nsenz8",
      authDomain: "aurora-beads-93a1b.firebaseapp.com",
      projectId: "aurora-beads-93a1b",
      storageBucket: "aurora-beads-93a1b.firebasestorage.app",
      messagingSenderId: "797821414540",
      appId: "1:797821414540:web:090de5940e33d15248dfa9"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Export Firebase modules to global scope
    window.firebaseModules = {
      db,
      auth,
      collection,
      addDoc,
      updateDoc,
      deleteDoc,
      doc,
      onSnapshot,
      query,
      where,
      orderBy,
      getDocs,
      serverTimestamp,
      setDoc,
      getDoc,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    };
  </script>
  <style>
    /* CSS tetap sama seperti sebelumnya */
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      --card-bg: rgba(255, 255, 255, 0.15);
      --card-border: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.85);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Poppins', sans-serif;
      position: relative;
      width: 100%;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--gradient-bg);
      z-index: -1;
    }

    .app-wrapper {
      width: 100%;
      min-height: 100%;
      padding: 20px;
    }

    .app-container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Auth Container */
    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100%;
      padding: 40px 20px;
    }

    .auth-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 50px 40px;
      box-shadow: var(--shadow);
      border: 1px solid var(--card-border);
      width: 100%;
      max-width: 480px;
    }

    .logo-section {
      text-align: center;
      margin-bottom: 35px;
    }

    .logo {
      font-size: 64px;
      margin-bottom: 15px;
      filter: drop-shadow(0 4px 12px rgba(240, 147, 251, 0.4));
    }

    .business-name {
      color: var(--text-primary);
      font-size: 34px;
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .auth-description {
      color: var(--text-secondary);
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 25px;
      text-align: center;
    }

    .login-info {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 25px;
      text-align: center;
    }

    .login-info h4 {
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .login-info p {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 5px;
    }

    .lang-switcher {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
    }

    .lang-btn {
      padding: 8px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .lang-btn.active {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 15px;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    .form-group select {
      cursor: pointer;
    }

    .form-group select option {
      background: #764ba2;
      color: var(--text-primary);
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      border: none;
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
      margin-top: 10px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(240, 147, 251, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .message {
      padding: 12px 18px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
      text-align: center;
    }

    .message.error {
      background: rgba(245, 87, 108, 0.2);
      border: 1px solid rgba(245, 87, 108, 0.4);
      color: var(--text-primary);
    }

    .message.success {
      background: rgba(56, 239, 125, 0.2);
      border: 1px solid rgba(56, 239, 125, 0.4);
      color: var(--text-primary);
    }

    .message.show {
      display: block;
    }

    /* Dashboard */
    .page-header {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid var(--card-border);
      text-align: center;
    }

    .page-header .logo {
      font-size: 80px;
      margin-bottom: 15px;
    }

    .page-header h1 {
      color: var(--text-primary);
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .page-header .tagline {
      color: var(--text-secondary);
      font-size: 16px;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }

    .nav-header {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 20px 30px;
      margin-bottom: 25px;
      border: 1px solid var(--card-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .nav-header h2 {
      color: var(--text-primary);
      font-size: 26px;
      font-weight: 600;
    }

    .nav-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn-secondary {
      padding: 10px 22px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .btn-logout {
      background: linear-gradient(135deg, #f5576c, #f093fb);
      border: none;
      box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
    }

    .btn-logout:hover {
      box-shadow: 0 6px 16px rgba(245, 87, 108, 0.4);
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
    }

    .menu-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 35px;
      border: 1px solid var(--card-border);
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
    }

    .menu-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
      background: rgba(255, 255, 255, 0.2);
    }

    .menu-icon {
      font-size: 56px;
      margin-bottom: 20px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
    }

    .menu-card h3 {
      color: var(--text-primary);
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .menu-card p {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }

    /* Journal Pages */
    .journal-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid var(--card-border);
      margin-bottom: 25px;
    }

    .journal-card h3 {
      color: var(--text-primary);
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 25px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .btn-add {
      padding: 12px 30px;
      background: linear-gradient(135deg, #11998e, #38ef7d);
      border: none;
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(56, 239, 125, 0.3);
    }

    .btn-add:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(56, 239, 125, 0.4);
    }

    .btn-add:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table thead {
      background: rgba(255, 255, 255, 0.1);
    }

    table th {
      padding: 15px;
      text-align: left;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    table td {
      padding: 15px;
      color: var(--text-secondary);
      font-size: 14px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    table tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .btn-edit,
    .btn-delete,
    .btn-cancel {
      padding: 6px 14px;
      border: none;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      margin-right: 8px;
      transition: all 0.3s ease;
    }

    .btn-edit {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .btn-delete {
      background: linear-gradient(135deg, #f5576c, #f093fb);
    }

    .btn-cancel {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn-edit:hover,
    .btn-delete:hover,
    .btn-cancel:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    /* Income Statement */
    .capital-section {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid var(--card-border);
      margin-bottom: 25px;
    }

    .capital-section h3 {
      color: var(--text-primary);
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .capital-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .capital-amount {
      font-size: 32px;
      font-weight: 700;
      color: #38ef7d;
    }

    .btn-edit-capital {
      padding: 10px 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-edit-capital:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .report-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid var(--card-border);
      text-align: center;
    }

    .summary-card h4 {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .summary-card .amount {
      color: var(--text-primary);
      font-size: 28px;
      font-weight: 700;
    }

    .summary-card.positive .amount {
      color: #38ef7d;
    }

    .summary-card.negative .amount {
      color: #f5576c;
    }

    .detail-table {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid var(--card-border);
    }

    .detail-table h3 {
      color: var(--text-primary);
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .table-responsive {
      overflow-x: auto;
    }

    .delete-confirm {
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .confirm-text {
      color: var(--text-primary);
      font-size: 12px;
      margin-right: 4px;
    }

    .btn-confirm-delete {
      padding: 6px 14px;
      background: linear-gradient(135deg, #f5576c, #f093fb);
      border: none;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-confirm-delete:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(245, 87, 108, 0.3);
    }

    .hidden {
      display: none !important;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top-color: #f093fb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .auth-card {
        padding: 40px 25px;
      }

      .business-name {
        font-size: 28px;
      }

      .page-header h1 {
        font-size: 30px;
      }

      .page-header .logo {
        font-size: 64px;
      }

      .nav-header {
        padding: 20px;
      }

      .nav-header h2 {
        font-size: 22px;
      }

      .journal-card {
        padding: 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 12px;
      }

      table th,
      table td {
        padding: 10px;
      }

      .menu-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <!-- Auth Page - Hanya Login -->
    <div id="authPage" class="page active">
      <div class="auth-container">
        <div class="auth-card">
          <div class="logo-section">
            <div class="logo">‚ú®</div>
            <h1 class="business-name" id="authBusinessName">Aurora Beads ‚ú®</h1>
            <p class="auth-description" id="authDescription">Silakan masukkan email dan password Anda üòä</p>
          </div>

          <div class="lang-switcher">
            <button class="lang-btn active" onclick="setLanguage('id')" id="langBtnId">üáÆüá© Indonesia</button>
            <button class="lang-btn" onclick="setLanguage('en')" id="langBtnEn">üá¨üáß English</button>
          </div>

          <div id="authMessage" class="message"></div>

          <!-- Login Form Saja -->
          <form onsubmit="handleLogin(event)">
            <div class="form-group">
              <label for="loginEmail" id="loginEmailLabel">Email</label>
              <input type="email" id="loginEmail" placeholder="Masukkan email Anda" required>
            </div>
            <div class="form-group">
              <label for="loginPassword" id="loginPasswordLabel">Password</label>
              <input type="password" id="loginPassword" placeholder="Masukkan password Anda" required>
            </div>
            <button type="submit" class="btn-primary" id="loginBtn">Login</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
      <div class="app-container">
        <div class="page-header">
          <div class="logo">‚ú®</div>
          <h1 id="dashboardBusinessName">Aurora Beads ‚ú®</h1>
          <p class="tagline" id="dashboardTagline">Your simple business overview. Cash flow, summaries, and insights all in one place üíóüìò</p>
        </div>
        <div class="nav-header">
          <h2 id="dashboardTitle">Dashboard</h2>
          <div class="nav-actions">
            <button class="btn-secondary" onclick="setLanguage(currentLanguage === 'id' ? 'en' : 'id')" id="langToggle"> üåê EN </button>
            <button class="btn-secondary btn-logout" onclick="handleLogout()" id="logoutBtn">Logout</button>
          </div>
        </div>
        <div class="menu-grid">
          <a href="#" onclick="showPage('cashReceipt'); return false;" class="menu-card">
            <div class="menu-icon">üí∞</div>
            <h3 id="menuCashReceipt">Cash Receipt Journal</h3>
            <p id="menuCashReceiptDesc">Catat penjualan produk dan pendapatan</p>
          </a>
          <a href="#" onclick="showPage('purchase'); return false;" class="menu-card">
            <div class="menu-icon">üõí</div>
            <h3 id="menuPurchase">Purchase Journal</h3>
            <p id="menuPurchaseDesc">Catat pembelian bahan baku dan barang</p>
          </a>
          <a href="#" onclick="showPage('cashPayment'); return false;" class="menu-card">
            <div class="menu-icon">üí∏</div>
            <h3 id="menuCashPayment">Cash Payment</h3>
            <p id="menuCashPaymentDesc">Catat beban operasional bisnis</p>
          </a>
          <a href="#" onclick="showPage('incomeStatement'); return false;" class="menu-card">
            <div class="menu-icon">üìä</div>
            <h3 id="menuIncomeStatement">Income Statement</h3>
            <p id="menuIncomeStatementDesc">Lihat laporan laba rugi</p>
          </a>
        </div>
      </div>
    </div>

    <!-- Cash Receipt Page -->
    <div id="cashReceiptPage" class="page">
      <div class="app-container">
        <div class="nav-header">
          <h2 id="cashReceiptTitle">Cash Receipt Journal</h2>
          <div class="nav-actions">
            <button class="btn-secondary" onclick="showPage('dashboard')" id="backToDashboard1">‚Üê Kembali</button>
          </div>
        </div>
        <div class="journal-card">
          <h3 id="addSaleTitle">Tambah Penjualan Baru</h3>
          <div id="saleMessage" class="message"></div>
          <form onsubmit="addSale(event)" id="saleForm">
            <div class="form-row">
              <div class="form-group">
                <label for="saleDate" id="saleDateLabel">Tanggal</label>
                <input type="date" id="saleDate" required>
              </div>
              <div class="form-group">
                <label for="saleProduct" id="saleProductLabel">Produk</label>
                <select id="saleProduct" required onchange="updateSaleTotal()">
                  <option value="">Pilih Produk</option>
                  <option value="Bracelet">Bracelet - Rp 10.000</option>
                  <option value="Necklace">Necklace - Rp 15.000</option>
                  <option value="Ring">Ring - Rp 5.000</option>
                  <option value="Hair Pins">Hair Pins - Rp 5.000</option>
                  <option value="Phone Strap">Phone Strap - Rp 20.000</option>
                  <option value="Keychain Small">Keychain Small - Rp 10.000</option>
                  <option value="Keychain Big">Keychain Big - Rp 20.000</option>
                </select>
              </div>
              <div class="form-group">
                <label for="saleQty" id="saleQtyLabel">Jumlah</label>
                <input type="number" id="saleQty" min="1" required oninput="updateSaleTotal()">
              </div>
              <div class="form-group">
                <label for="saleTotal" id="saleTotalLabel">Total</label>
                <input type="text" id="saleTotal" readonly style="background: rgba(255,255,255,0.1);">
              </div>
            </div>
            <button type="submit" class="btn-add" id="addSaleBtn">Tambah Penjualan</button>
          </form>
        </div>
        <div class="journal-card">
          <h3 id="salesListTitle">Daftar Penjualan</h3>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th id="thSaleDate">Tanggal</th>
                  <th id="thSaleProduct">Produk</th>
                  <th id="thSaleQty">Jumlah</th>
                  <th id="thSaleTotal">Total</th>
                  <th id="thSaleAction">Aksi</th>
                </tr>
              </thead>
              <tbody id="salesTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Purchase Journal Page -->
    <div id="purchasePage" class="page">
      <div class="app-container">
        <div class="nav-header">
          <h2 id="purchaseTitle">Purchase Journal</h2>
          <div class="nav-actions">
            <button class="btn-secondary" onclick="showPage('dashboard')" id="backToDashboard2">‚Üê Kembali</button>
          </div>
        </div>
        <div class="journal-card">
          <h3 id="addPurchaseTitle">Tambah Pembelian Baru</h3>
          <div id="purchaseMessage" class="message"></div>
          <form onsubmit="addPurchase(event)" id="purchaseForm">
            <div class="form-row">
              <div class="form-group">
                <label for="purchaseDate" id="purchaseDateLabel">Tanggal</label>
                <input type="date" id="purchaseDate" required>
              </div>
              <div class="form-group">
                <label for="purchaseProduct" id="purchaseProductLabel">Produk/Bahan</label>
                <input type="text" id="purchaseProduct" placeholder="Nama produk/bahan" required>
              </div>
              <div class="form-group">
                <label for="purchasePrice" id="purchasePriceLabel">Harga Per Unit</label>
                <input type="number" id="purchasePrice" min="0" placeholder="0" required oninput="updatePurchaseTotal()">
              </div>
              <div class="form-group">
                <label for="purchaseQty" id="purchaseQtyLabel">Jumlah</label>
                <input type="number" id="purchaseQty" min="1" required oninput="updatePurchaseTotal()">
              </div>
              <div class="form-group">
                <label for="purchaseTotal" id="purchaseTotalLabel">Total</label>
                <input type="text" id="purchaseTotal" readonly style="background: rgba(255,255,255,0.1);">
              </div>
            </div>
            <button type="submit" class="btn-add" id="addPurchaseBtn">Tambah Pembelian</button>
          </form>
        </div>
        <div class="journal-card">
          <h3 id="purchaseListTitle">Daftar Pembelian</h3>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th id="thPurchaseDate">Tanggal</th>
                  <th id="thPurchaseProduct">Produk/Bahan</th>
                  <th id="thPurchasePrice">Harga/Unit</th>
                  <th id="thPurchaseQty">Jumlah</th>
                  <th id="thPurchaseTotal">Total</th>
                  <th id="thPurchaseAction">Aksi</th>
                </tr>
              </thead>
              <tbody id="purchaseTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Cash Payment Page -->
    <div id="cashPaymentPage" class="page">
      <div class="app-container">
        <div class="nav-header">
          <h2 id="cashPaymentTitle">Cash Payment</h2>
          <div class="nav-actions">
            <button class="btn-secondary" onclick="showPage('dashboard')" id="backToDashboard3">‚Üê Kembali</button>
          </div>
        </div>
        <div class="journal-card">
          <h3 id="addExpenseTitle">Tambah Beban Baru</h3>
          <div id="expenseMessage" class="message"></div>
          <form onsubmit="addExpense(event)" id="expenseForm">
            <div class="form-row">
              <div class="form-group">
                <label for="expenseDate" id="expenseDateLabel">Tanggal</label>
                <input type="date" id="expenseDate" required>
              </div>
              <div class="form-group">
                <label for="expenseDescription" id="expenseDescriptionLabel">Keterangan Beban</label>
                <input type="text" id="expenseDescription" placeholder="Contoh: Beban Listrik" required>
              </div>
              <div class="form-group">
                <label for="expenseAmount" id="expenseAmountLabel">Jumlah</label>
                <input type="number" id="expenseAmount" min="0" placeholder="0" required>
              </div>
            </div>
            <button type="submit" class="btn-add" id="addExpenseBtn">Tambah Beban</button>
          </form>
        </div>
        <div class="journal-card">
          <h3 id="expenseListTitle">Daftar Beban</h3>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th id="thExpenseDate">Tanggal</th>
                  <th id="thExpenseDescription">Keterangan</th>
                  <th id="thExpenseAmount">Jumlah</th>
                  <th id="thExpenseAction">Aksi</th>
                </tr>
              </thead>
              <tbody id="expenseTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Income Statement Page -->
    <div id="incomeStatementPage" class="page">
      <div class="app-container">
        <div class="nav-header">
          <h2 id="incomeStatementTitle">Laporan Laba Rugi</h2>
          <div class="nav-actions">
            <button class="btn-secondary" onclick="showPage('dashboard')" id="backToDashboard4">‚Üê Kembali</button>
          </div>
        </div>
        <div class="capital-section">
          <h3 id="capitalTitle">Modal Awal</h3>
          <div id="capitalDisplaySection" class="capital-display">
            <div class="capital-amount" id="displayCapital">Rp 0</div>
            <button class="btn-edit-capital" onclick="toggleCapitalEdit()" id="editCapitalBtn">Edit Modal</button>
          </div>
          <div id="capitalEditSection" class="hidden">
            <form onsubmit="saveCapital(event)">
              <div class="form-row">
                <div class="form-group">
                  <label for="capitalInput" id="capitalInputLabel">Masukkan Modal Awal</label>
                  <input type="number" id="capitalInput" min="0" placeholder="0" required>
                </div>
              </div>
              <button type="submit" class="btn-add" id="saveCapitalBtn">Simpan Modal</button>
              <button type="button" class="btn-cancel" onclick="toggleCapitalEdit()" id="cancelCapitalBtn" style="margin-left: 10px;">Batal</button>
            </form>
          </div>
        </div>
        <div class="report-summary">
          <div class="summary-card">
            <h4 id="labelRevenue">Pendapatan</h4>
            <div class="amount" id="displayRevenue">Rp 0</div>
          </div>
          <div class="summary-card">
            <h4 id="labelCOGS">Harga Pokok Penjualan</h4>
            <div class="amount" id="displayCOGS">Rp 0</div>
          </div>
          <div class="summary-card positive">
            <h4 id="labelGrossProfit">Laba Kotor</h4>
            <div class="amount" id="displayGrossProfit">Rp 0</div>
          </div>
          <div class="summary-card">
            <h4 id="labelExpenses">Beban Operasional</h4>
            <div class="amount" id="displayExpenses">Rp 0</div>
          </div>
          <div class="summary-card positive">
            <h4 id="labelNetProfit">Laba Bersih</h4>
            <div class="amount" id="displayNetProfit">Rp 0</div>
          </div>
        </div>
        <div class="detail-table">
          <h3 id="detailReportTitle">Detail Laporan</h3>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th id="thReportItem">Item</th>
                  <th id="thReportAmount">Jumlah</th>
                </tr>
              </thead>
              <tbody id="reportTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // Wait for Firebase to load
    let firebaseLoaded = false;
    const checkFirebaseLoaded = setInterval(() => {
      if (window.firebaseModules) {
        firebaseLoaded = true;
        clearInterval(checkFirebaseLoaded);
        initApp();
      }
    }, 100);

    const defaultConfig = {
      business_name: "Aurora Beads ‚ú®",
      tagline: "Your simple business overview. Cash flow, summaries, and insights all in one place üíóüìò",
      login_description: "Silakan masukkan email dan password Anda üòä"
    };

    const productPrices = {
      'Bracelet': 10000,
      'Necklace': 15000,
      'Ring': 5000,
      'Hair Pins': 5000,
      'Phone Strap': 20000,
      'Keychain Small': 10000,
      'Keychain Big': 20000
    };

    const translations = {
      id: {
        login: "Login",
        email: "Email",
        password: "Password",
        loginBtn: "Login",
        loginDescription: "Silakan masukkan email dan password Anda üòä",
        dashboard: "Beranda",
        dashboardTagline: "Your simple business overview. Cash flow, summaries, and insights all in one place üíóüìò",
        menuCashReceipt: "Cash Receipt Journal",
        menuCashReceiptDesc: "Catat penjualan produk dan pendapatan",
        menuPurchase: "Purchase Journal",
        menuPurchaseDesc: "Catat pembelian bahan baku dan barang",
        menuCashPayment: "Cash Payment",
        menuCashPaymentDesc: "Catat beban operasional bisnis",
        menuIncomeStatement: "Laporan Laba Rugi",
        menuIncomeStatementDesc: "Lihat laporan laba rugi",
        logout: "Keluar",
        back: "‚Üê Kembali",
        cashReceiptTitle: "Cash Receipt Journal",
        addSaleTitle: "Tambah Penjualan Baru",
        date: "Tanggal",
        product: "Produk",
        qty: "Jumlah",
        total: "Total",
        action: "Aksi",
        addSale: "Tambah Penjualan",
        salesList: "Daftar Penjualan",
        edit: "Edit",
        delete: "Hapus",
        selectProduct: "Pilih Produk",
        cancel: "Batal",
        confirmDelete: "Yakin hapus?",
        purchaseTitle: "Purchase Journal",
        addPurchaseTitle: "Tambah Pembelian Baru",
        purchaseProduct: "Produk/Bahan",
        pricePerUnit: "Harga Per Unit",
        addPurchase: "Tambah Pembelian",
        purchaseList: "Daftar Pembelian",
        cashPaymentTitle: "Cash Payment",
        addExpenseTitle: "Tambah Beban Baru",
        expenseDescription: "Keterangan Beban",
        amount: "Jumlah",
        addExpense: "Tambah Beban",
        expenseList: "Daftar Beban",
        expensePlaceholder: "Contoh: Beban Listrik",
        incomeStatementTitle: "Laporan Laba Rugi",
        capitalTitle: "Modal Awal",
        editCapital: "Edit Modal",
        saveCapital: "Simpan Modal",
        cancelCapital: "Batal",
        capitalInputLabel: "Masukkan Modal Awal",
        revenue: "Pendapatan",
        cogs: "Harga Pokok Penjualan",
        grossProfit: "Laba Kotor",
        expenses: "Beban Operasional",
        netProfit: "Laba Bersih",
        detailReport: "Detail Laporan",
        item: "Item",
        loginSuccess: "Login berhasil! Selamat datang üíñ",
        loginError: "Email atau password salah",
        saleAdded: "Penjualan berhasil ditambahkan! ‚ú®",
        purchaseAdded: "Pembelian berhasil ditambahkan! ‚ú®",
        expenseAdded: "Beban berhasil ditambahkan! ‚ú®",
        saleUpdated: "Penjualan berhasil diperbarui! ‚ú®",
        purchaseUpdated: "Pembelian berhasil diperbarui! ‚ú®",
        expenseUpdated: "Beban berhasil diperbarui! ‚ú®",
        capitalSaved: "Modal awal berhasil disimpan! ‚ú®",
        noData: "Belum ada data",
        langIndonesia: "üáÆüá© Indonesia",
        langEnglish: "üá¨üáß English",
        dataLimit: "Maksimum 999 data tercapai. Hapus beberapa data terlebih dahulu."
      },
      en: {
        login: "Login",
        email: "Email",
        password: "Password",
        loginBtn: "Login",
        loginDescription: "Please enter your email and password üòä",
        dashboard: "Dashboard",
        dashboardTagline: "Your simple business overview. Cash flow, summaries, and insights all in one place üíóüìò",
        menuCashReceipt: "Cash Receipt Journal",
        menuCashReceiptDesc: "Record product sales and revenue",
        menuPurchase: "Purchase Journal",
        menuPurchaseDesc: "Record raw material and goods purchases",
        menuCashPayment: "Cash Payment",
        menuCashPaymentDesc: "Record business operational expenses",
        menuIncomeStatement: "Income Statement",
        menuIncomeStatementDesc: "View profit and loss report",
        logout: "Logout",
        back: "‚Üê Back",
        cashReceiptTitle: "Cash Receipt Journal",
        addSaleTitle: "Add New Sale",
        date: "Date",
        product: "Product",
        qty: "Quantity",
        total: "Total",
        action: "Action",
        addSale: "Add Sale",
        salesList: "Sales List",
        edit: "Edit",
        delete: "Delete",
        selectProduct: "Select Product",
        cancel: "Cancel",
        confirmDelete: "Confirm delete?",
        purchaseTitle: "Purchase Journal",
        addPurchaseTitle: "Add New Purchase",
        purchaseProduct: "Product/Material",
        pricePerUnit: "Price Per Unit",
        addPurchase: "Add Purchase",
        purchaseList: "Purchase List",
        cashPaymentTitle: "Cash Payment",
        addExpenseTitle: "Add New Expense",
        expenseDescription: "Expense Description",
        amount: "Amount",
        addExpense: "Add Expense",
        expenseList: "Expense List",
        expensePlaceholder: "Example: Electricity Bill",
        incomeStatementTitle: "Income Statement",
        capitalTitle: "Initial Capital",
        editCapital: "Edit Capital",
        saveCapital: "Save Capital",
        cancelCapital: "Cancel",
        capitalInputLabel: "Enter Initial Capital",
        revenue: "Revenue",
        cogs: "Cost of Goods Sold",
        grossProfit: "Gross Profit",
        expenses: "Operating Expenses",
        netProfit: "Net Profit",
        detailReport: "Detailed Report",
        item: "Item",
        loginSuccess: "Login successful! Welcome üíñ",
        loginError: "Invalid email or password",
        saleAdded: "Sale added successfully! ‚ú®",
        purchaseAdded: "Purchase added successfully! ‚ú®",
        expenseAdded: "Expense added successfully! ‚ú®",
        saleUpdated: "Sale updated successfully! ‚ú®",
        purchaseUpdated: "Purchase updated successfully! ‚ú®",
        expenseUpdated: "Expense updated successfully! ‚ú®",
        capitalSaved: "Initial capital saved successfully! ‚ú®",
        noData: "No data yet",
        langIndonesia: "üáÆüá© Indonesia",
        langEnglish: "üá¨üáß English",
        dataLimit: "Maximum limit of 999 records reached. Please delete some records first."
      }
    };

    let currentUser = null;
    let currentLanguage = 'id';
    let editingRecordId = null;
    let deleteConfirmId = null;
    let deleteConfirmType = null;
    let allData = [];

    // Initialize app
    async function initApp() {
      showLoading();
      
      const savedLanguage = localStorage.getItem('aurora_language') || 'id';
      currentLanguage = savedLanguage;
      
      // Check if user is logged in
      window.firebaseModules.onAuthStateChanged(window.firebaseModules.auth, (user) => {
        if (user) {
          currentUser = user;
          setupRealtimeListeners();
          showPage('dashboard');
        } else {
          showPage('auth');
        }
        
        updateLanguage();
        setTodayDate();
        hideLoading();
      });
    }

    // Setup real-time listeners for data changes
    function setupRealtimeListeners() {
      if (!currentUser) return;

      // Sales listener
      const salesQuery = window.firebaseModules.query(
        window.firebaseModules.collection(window.firebaseModules.db, 'sales'),
        window.firebaseModules.where('userId', '==', currentUser.uid),
        window.firebaseModules.orderBy('timestamp', 'desc')
      );

      window.firebaseModules.onSnapshot(salesQuery, (snapshot) => {
        const salesData = [];
        snapshot.forEach(doc => {
          salesData.push({
            id: doc.id,
            type: 'sale',
            ...doc.data()
          });
        });
        
        allData = allData.filter(item => item.type !== 'sale');
        allData.push(...salesData);
        
        if (document.getElementById('cashReceiptPage').classList.contains('active')) {
          renderSalesTable();
        }
        
        if (document.getElementById('incomeStatementPage').classList.contains('active')) {
          calculateIncomeStatement();
        }
      });

      // Purchases listener
      const purchasesQuery = window.firebaseModules.query(
        window.firebaseModules.collection(window.firebaseModules.db, 'purchases'),
        window.firebaseModules.where('userId', '==', currentUser.uid),
        window.firebaseModules.orderBy('timestamp', 'desc')
      );

      window.firebaseModules.onSnapshot(purchasesQuery, (snapshot) => {
        const purchasesData = [];
        snapshot.forEach(doc => {
          purchasesData.push({
            id: doc.id,
            type: 'purchase',
            ...doc.data()
          });
        });
        
        allData = allData.filter(item => item.type !== 'purchase');
        allData.push(...purchasesData);
        
        if (document.getElementById('purchasePage').classList.contains('active')) {
          renderPurchaseTable();
        }
        
        if (document.getElementById('incomeStatementPage').classList.contains('active')) {
          calculateIncomeStatement();
        }
      });

      // Expenses listener
      const expensesQuery = window.firebaseModules.query(
        window.firebaseModules.collection(window.firebaseModules.db, 'expenses'),
        window.firebaseModules.where('userId', '==', currentUser.uid),
        window.firebaseModules.orderBy('timestamp', 'desc')
      );

      window.firebaseModules.onSnapshot(expensesQuery, (snapshot) => {
        const expensesData = [];
        snapshot.forEach(doc => {
          expensesData.push({
            id: doc.id,
            type: 'expense',
            ...doc.data()
          });
        });
        
        allData = allData.filter(item => item.type !== 'expense');
        allData.push(...expensesData);
        
        if (document.getElementById('cashPaymentPage').classList.contains('active')) {
          renderExpenseTable();
        }
        
        if (document.getElementById('incomeStatementPage').classList.contains('active')) {
          calculateIncomeStatement();
        }
      });
    }

    // Handle login with Firebase Auth
    async function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const password = document.getElementById('loginPassword').value;
      
      try {
        showLoading();
        const userCredential = await window.firebaseModules.signInWithEmailAndPassword(
          window.firebaseModules.auth, email, password
        );
        currentUser = userCredential.user;
        
        showMessage('authMessage', translations[currentLanguage].loginSuccess, 'success');
        
        setTimeout(() => {
          setupRealtimeListeners();
          showPage('dashboard');
          hideMessage('authMessage');
          hideLoading();
        }, 1000);
      } catch (error) {
        hideLoading();
        showMessage('authMessage', translations[currentLanguage].loginError, 'error');
        console.error("Login error:", error);
      }
    }

    // Handle logout
    function handleLogout() {
      window.firebaseModules.signOut(window.firebaseModules.auth).then(() => {
        currentUser = null;
        allData = [];
        showPage('auth');
      }).catch((error) => {
        console.error("Logout error:", error);
      });
    }

    // Add sale function
    async function addSale(event) {
      event.preventDefault();
      
      if (!currentUser) return;
      
      const date = document.getElementById('saleDate').value;
      const product = document.getElementById('saleProduct').value;
      const quantity = parseInt(document.getElementById('saleQty').value);
      const total = productPrices[product] * quantity;
      
      const saleData = {
        userId: currentUser.uid,
        date,
        product,
        quantity,
        total,
        timestamp: window.firebaseModules.serverTimestamp()
      };
      
      try {
        const btn = document.getElementById('addSaleBtn');
        btn.disabled = true;
        showLoading();
        
        if (editingRecordId) {
          await window.firebaseModules.updateDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'sales', editingRecordId),
            saleData
          );
          showMessage('saleMessage', translations[currentLanguage].saleUpdated, 'success');
          editingRecordId = null;
        } else {
          await window.firebaseModules.addDoc(
            window.firebaseModules.collection(window.firebaseModules.db, 'sales'),
            saleData
          );
          showMessage('saleMessage', translations[currentLanguage].saleAdded, 'success');
        }
        
        document.getElementById('saleForm').reset();
        setTodayDate();
        updateLanguage();
        
        setTimeout(() => {
          hideMessage('saleMessage');
          btn.disabled = false;
          hideLoading();
        }, 2000);
      } catch (error) {
        hideLoading();
        showMessage('saleMessage', 'Error: ' + error.message, 'error');
        console.error("Error adding sale:", error);
      }
    }

    // Helper functions
    function showLoading() {
      document.getElementById('loadingOverlay').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    function setTodayDate() {
      const today = new Date().toISOString().split('T')[0];
      const dateInputs = ['saleDate', 'purchaseDate', 'expenseDate'];
      dateInputs.forEach(id => {
        const input = document.getElementById(id);
        if (input && !input.value) input.value = today;
      });
    }

    function setLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('aurora_language', lang);
      updateLanguage();
    }

    function updateLanguage() {
      const t = translations[currentLanguage];
      
      document.getElementById('langBtnId').classList.toggle('active', currentLanguage === 'id');
      document.getElementById('langBtnEn').classList.toggle('active', currentLanguage === 'en');
      
      const langToggle = document.getElementById('langToggle');
      if (langToggle) {
        langToggle.textContent = currentLanguage === 'id' ? 'üåê EN' : 'üåê ID';
      }
      
      document.getElementById('authDescription').textContent = t.loginDescription;
      document.getElementById('loginEmailLabel').textContent = t.email;
      document.getElementById('loginPasswordLabel').textContent = t.password;
      document.getElementById('loginBtn').textContent = t.loginBtn;
      
      const dashboardTitle = document.getElementById('dashboardTitle');
      if (dashboardTitle) dashboardTitle.textContent = t.dashboard;
      
      const dashboardTagline = document.getElementById('dashboardTagline');
      if (dashboardTagline) dashboardTagline.textContent = t.dashboardTagline;
      
      document.getElementById('menuCashReceipt').textContent = t.menuCashReceipt;
      document.getElementById('menuCashReceiptDesc').textContent = t.menuCashReceiptDesc;
      document.getElementById('menuPurchase').textContent = t.menuPurchase;
      document.getElementById('menuPurchaseDesc').textContent = t.menuPurchaseDesc;
      document.getElementById('menuCashPayment').textContent = t.menuCashPayment;
      document.getElementById('menuCashPaymentDesc').textContent = t.menuCashPaymentDesc;
      document.getElementById('menuIncomeStatement').textContent = t.menuIncomeStatement;
      document.getElementById('menuIncomeStatementDesc').textContent = t.menuIncomeStatementDesc;
      
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.textContent = t.logout;
      
      document.getElementById('cashReceiptTitle').textContent = t.cashReceiptTitle;
      document.getElementById('addSaleTitle').textContent = t.addSaleTitle;
      document.getElementById('saleDateLabel').textContent = t.date;
      document.getElementById('saleProductLabel').textContent = t.product;
      document.getElementById('saleQtyLabel').textContent = t.qty;
      document.getElementById('saleTotalLabel').textContent = t.total;
      document.getElementById('addSaleBtn').textContent = editingRecordId ? t.edit : t.addSale;
      document.getElementById('salesListTitle').textContent = t.salesList;
      document.getElementById('thSaleDate').textContent = t.date;
      document.getElementById('thSaleProduct').textContent = t.product;
      document.getElementById('thSaleQty').textContent = t.qty;
      document.getElementById('thSaleTotal').textContent = t.total;
      document.getElementById('thSaleAction').textContent = t.action;
      
      document.getElementById('purchaseTitle').textContent = t.purchaseTitle;
      document.getElementById('addPurchaseTitle').textContent = t.addPurchaseTitle;
      document.getElementById('purchaseDateLabel').textContent = t.date;
      document.getElementById('purchaseProductLabel').textContent = t.purchaseProduct;
      document.getElementById('purchasePriceLabel').textContent = t.pricePerUnit;
      document.getElementById('purchaseQtyLabel').textContent = t.qty;
      document.getElementById('purchaseTotalLabel').textContent = t.total;
      document.getElementById('addPurchaseBtn').textContent = editingRecordId ? t.edit : t.addPurchase;
      document.getElementById('purchaseListTitle').textContent = t.purchaseList;
      document.getElementById('thPurchaseDate').textContent = t.date;
      document.getElementById('thPurchaseProduct').textContent = t.purchaseProduct;
      document.getElementById('thPurchasePrice').textContent = t.pricePerUnit;
      document.getElementById('thPurchaseQty').textContent = t.qty;
      document.getElementById('thPurchaseTotal').textContent = t.total;
      document.getElementById('thPurchaseAction').textContent = t.action;
      
      document.getElementById('cashPaymentTitle').textContent = t.cashPaymentTitle;
      document.getElementById('addExpenseTitle').textContent = t.addExpenseTitle;
      document.getElementById('expenseDateLabel').textContent = t.date;
      document.getElementById('expenseDescriptionLabel').textContent = t.expenseDescription;
      document.getElementById('expenseAmountLabel').textContent = t.amount;
      document.getElementById('addExpenseBtn').textContent = editingRecordId ? t.edit : t.addExpense;
      document.getElementById('expenseListTitle').textContent = t.expenseList;
      document.getElementById('thExpenseDate').textContent = t.date;
      document.getElementById('thExpenseDescription').textContent = t.expenseDescription;
      document.getElementById('thExpenseAmount').textContent = t.amount;
      document.getElementById('thExpenseAction').textContent = t.action;
      document.getElementById('expenseDescription').placeholder = t.expensePlaceholder;
      
      document.getElementById('incomeStatementTitle').textContent = t.incomeStatementTitle;
      document.getElementById('capitalTitle').textContent = t.capitalTitle;
      document.getElementById('editCapitalBtn').textContent = t.editCapital;
      document.getElementById('saveCapitalBtn').textContent = t.saveCapital;
      document.getElementById('cancelCapitalBtn').textContent = t.cancelCapital;
      document.getElementById('capitalInputLabel').textContent = t.capitalInputLabel;
      document.getElementById('labelRevenue').textContent = t.revenue;
      document.getElementById('labelCOGS').textContent = t.cogs;
      document.getElementById('labelGrossProfit').textContent = t.grossProfit;
      document.getElementById('labelExpenses').textContent = t.expenses;
      document.getElementById('labelNetProfit').textContent = t.netProfit;
      document.getElementById('detailReportTitle').textContent = t.detailReport;
      document.getElementById('thReportItem').textContent = t.item;
      document.getElementById('thReportAmount').textContent = t.amount;
      
      ['backToDashboard1', 'backToDashboard2', 'backToDashboard3', 'backToDashboard4'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.textContent = t.back;
      });
      
      if (currentUser) {
        renderSalesTable();
        renderPurchaseTable();
        renderExpenseTable();
        calculateIncomeStatement();
      }
    }

    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      
      if (pageName === 'auth') {
        document.getElementById('authPage').classList.add('active');
      } else if (pageName === 'dashboard') {
        document.getElementById('dashboardPage').classList.add('active');
      } else if (pageName === 'cashReceipt') {
        document.getElementById('cashReceiptPage').classList.add('active');
        renderSalesTable();
        cancelEdit();
      } else if (pageName === 'purchase') {
        document.getElementById('purchasePage').classList.add('active');
        renderPurchaseTable();
        cancelEdit();
      } else if (pageName === 'cashPayment') {
        document.getElementById('cashPaymentPage').classList.add('active');
        renderExpenseTable();
        cancelEdit();
      } else if (pageName === 'incomeStatement') {
        document.getElementById('incomeStatementPage').classList.add('active');
        loadCapital();
        calculateIncomeStatement();
      }
      
      setTodayDate();
      window.scrollTo(0, 0);
    }

    function updateSaleTotal() {
      const product = document.getElementById('saleProduct').value;
      const qty = parseInt(document.getElementById('saleQty').value) || 0;
      
      if (product && productPrices[product]) {
        const total = productPrices[product] * qty;
        document.getElementById('saleTotal').value = formatCurrency(total);
      } else {
        document.getElementById('saleTotal').value = '';
      }
    }

    function renderSalesTable() {
      const tbody = document.getElementById('salesTableBody');
      const sales = allData.filter(d => d.type === 'sale');
      const t = translations[currentLanguage];
      
      if (sales.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.6);">
              ${t.noData}
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = sales.map(sale => {
        if (deleteConfirmId === sale.id && deleteConfirmType === 'sale') {
          return `
            <tr>
              <td>${sale.date}</td>
              <td>${sale.product}</td>
              <td>${sale.quantity}</td>
              <td>${formatCurrency(sale.total)}</td>
              <td>
                <div class="delete-confirm">
                  <span class="confirm-text">${t.confirmDelete}</span>
                  <button class="btn-confirm-delete" onclick="confirmDelete('${sale.id}', 'sale')">${t.delete}</button>
                  <button class="btn-cancel" onclick="cancelDelete()">${t.cancel}</button>
                </div>
              </td>
            </tr>
          `;
        }
        return `
          <tr>
            <td>${sale.date}</td>
            <td>${sale.product}</td>
            <td>${sale.quantity}</td>
            <td>${formatCurrency(sale.total)}</td>
            <td>
              <button class="btn-edit" onclick="editRecord('${sale.id}', 'sale')">${t.edit}</button>
              <button class="btn-delete" onclick="initDelete('${sale.id}', 'sale')">${t.delete}</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function editRecord(id, type) {
      const record = allData.find(d => d.id === id);
      if (!record) return;
      
      editingRecordId = id;
      
      if (type === 'sale') {
        document.getElementById('saleDate').value = record.date;
        document.getElementById('saleProduct').value = record.product;
        document.getElementById('saleQty').value = record.quantity;
        updateSaleTotal();
      } else if (type === 'purchase') {
        document.getElementById('purchaseDate').value = record.date;
        document.getElementById('purchaseProduct').value = record.product;
        document.getElementById('purchasePrice').value = record.price;
        document.getElementById('purchaseQty').value = record.quantity;
        updatePurchaseTotal();
      } else if (type === 'expense') {
        document.getElementById('expenseDate').value = record.date;
        document.getElementById('expenseDescription').value = record.description;
        document.getElementById('expenseAmount').value = record.amount;
      }
      
      updateLanguage();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function cancelEdit() {
      editingRecordId = null;
      document.getElementById('saleForm')?.reset();
      document.getElementById('purchaseForm')?.reset();
      document.getElementById('expenseForm')?.reset();
      setTodayDate();
      updateLanguage();
    }

    function updatePurchaseTotal() {
      const price = parseFloat(document.getElementById('purchasePrice').value) || 0;
      const qty = parseInt(document.getElementById('purchaseQty').value) || 0;
      const total = price * qty;
      document.getElementById('purchaseTotal').value = formatCurrency(total);
    }

    async function addPurchase(event) {
      event.preventDefault();
      
      if (!currentUser) return;
      
      const date = document.getElementById('purchaseDate').value;
      const product = document.getElementById('purchaseProduct').value;
      const price = parseFloat(document.getElementById('purchasePrice').value);
      const quantity = parseInt(document.getElementById('purchaseQty').value);
      const total = price * quantity;
      
      const purchaseData = {
        userId: currentUser.uid,
        date,
        product,
        price,
        quantity,
        total,
        timestamp: window.firebaseModules.serverTimestamp()
      };
      
      try {
        const btn = document.getElementById('addPurchaseBtn');
        btn.disabled = true;
        showLoading();
        
        if (editingRecordId) {
          await window.firebaseModules.updateDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'purchases', editingRecordId),
            purchaseData
          );
          showMessage('purchaseMessage', translations[currentLanguage].purchaseUpdated, 'success');
          editingRecordId = null;
        } else {
          await window.firebaseModules.addDoc(
            window.firebaseModules.collection(window.firebaseModules.db, 'purchases'),
            purchaseData
          );
          showMessage('purchaseMessage', translations[currentLanguage].purchaseAdded, 'success');
        }
        
        document.getElementById('purchaseForm').reset();
        setTodayDate();
        updateLanguage();
        
        setTimeout(() => {
          hideMessage('purchaseMessage');
          btn.disabled = false;
          hideLoading();
        }, 2000);
      } catch (error) {
        hideLoading();
        showMessage('purchaseMessage', 'Error: ' + error.message, 'error');
        console.error("Error adding purchase:", error);
      }
    }

    function renderPurchaseTable() {
      const tbody = document.getElementById('purchaseTableBody');
      const purchases = allData.filter(d => d.type === 'purchase');
      const t = translations[currentLanguage];
      
      if (purchases.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.6);">
              ${t.noData}
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = purchases.map(purchase => {
        if (deleteConfirmId === purchase.id && deleteConfirmType === 'purchase') {
          return `
            <tr>
              <td>${purchase.date}</td>
              <td>${purchase.product}</td>
              <td>${formatCurrency(purchase.price)}</td>
              <td>${purchase.quantity}</td>
              <td>${formatCurrency(purchase.total)}</td>
              <td>
                <div class="delete-confirm">
                  <span class="confirm-text">${t.confirmDelete}</span>
                  <button class="btn-confirm-delete" onclick="confirmDelete('${purchase.id}', 'purchase')">${t.delete}</button>
                  <button class="btn-cancel" onclick="cancelDelete()">${t.cancel}</button>
                </div>
              </td>
            </tr>
          `;
        }
        return `
          <tr>
            <td>${purchase.date}</td>
            <td>${purchase.product}</td>
            <td>${formatCurrency(purchase.price)}</td>
            <td>${purchase.quantity}</td>
            <td>${formatCurrency(purchase.total)}</td>
            <td>
              <button class="btn-edit" onclick="editRecord('${purchase.id}', 'purchase')">${t.edit}</button>
              <button class="btn-delete" onclick="initDelete('${purchase.id}', 'purchase')">${t.delete}</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    async function addExpense(event) {
      event.preventDefault();
      
      if (!currentUser) return;
      
      const date = document.getElementById('expenseDate').value;
      const description = document.getElementById('expenseDescription').value;
      const amount = parseInt(document.getElementById('expenseAmount').value);
      
      const expenseData = {
        userId: currentUser.uid,
        date,
        description,
        amount,
        timestamp: window.firebaseModules.serverTimestamp()
      };
      
      try {
        const btn = document.getElementById('addExpenseBtn');
        btn.disabled = true;
        showLoading();
        
        if (editingRecordId) {
          await window.firebaseModules.updateDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'expenses', editingRecordId),
            expenseData
          );
          showMessage('expenseMessage', translations[currentLanguage].expenseUpdated, 'success');
          editingRecordId = null;
        } else {
          await window.firebaseModules.addDoc(
            window.firebaseModules.collection(window.firebaseModules.db, 'expenses'),
            expenseData
          );
          showMessage('expenseMessage', translations[currentLanguage].expenseAdded, 'success');
        }
        
        document.getElementById('expenseForm').reset();
        setTodayDate();
        updateLanguage();
        
        setTimeout(() => {
          hideMessage('expenseMessage');
          btn.disabled = false;
          hideLoading();
        }, 2000);
      } catch (error) {
        hideLoading();
        showMessage('expenseMessage', 'Error: ' + error.message, 'error');
        console.error("Error adding expense:", error);
      }
    }

    function renderExpenseTable() {
      const tbody = document.getElementById('expenseTableBody');
      const expenses = allData.filter(d => d.type === 'expense');
      const t = translations[currentLanguage];
      
      if (expenses.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.6);">
              ${t.noData}
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = expenses.map(expense => {
        if (deleteConfirmId === expense.id && deleteConfirmType === 'expense') {
          return `
            <tr>
              <td>${expense.date}</td>
              <td>${expense.description}</td>
              <td>${formatCurrency(expense.amount)}</td>
              <td>
                <div class="delete-confirm">
                  <span class="confirm-text">${t.confirmDelete}</span>
                  <button class="btn-confirm-delete" onclick="confirmDelete('${expense.id}', 'expense')">${t.delete}</button>
                  <button class="btn-cancel" onclick="cancelDelete()">${t.cancel}</button>
                </div>
              </td>
            </tr>
          `;
        }
        return `
          <tr>
            <td>${expense.date}</td>
            <td>${expense.description}</td>
            <td>${formatCurrency(expense.amount)}</td>
            <td>
              <button class="btn-edit" onclick="editRecord('${expense.id}', 'expense')">${t.edit}</button>
              <button class="btn-delete" onclick="initDelete('${expense.id}', 'expense')">${t.delete}</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function initDelete(id, type) {
      deleteConfirmId = id;
      deleteConfirmType = type;
      
      if (type === 'sale') renderSalesTable();
      else if (type === 'purchase') renderPurchaseTable();
      else if (type === 'expense') renderExpenseTable();
    }

    async function confirmDelete(id, type) {
      try {
        showLoading();
        
        if (type === 'sale') {
          await window.firebaseModules.deleteDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'sales', id)
          );
        } else if (type === 'purchase') {
          await window.firebaseModules.deleteDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'purchases', id)
          );
        } else if (type === 'expense') {
          await window.firebaseModules.deleteDoc(
            window.firebaseModules.doc(window.firebaseModules.db, 'expenses', id)
          );
        }
        
        deleteConfirmId = null;
        deleteConfirmType = null;
        
        hideLoading();
      } catch (error) {
        hideLoading();
        console.error("Error deleting record:", error);
        showMessage('saleMessage', 'Error: ' + error.message, 'error');
      }
    }

    function cancelDelete() {
      deleteConfirmId = null;
      deleteConfirmType = null;
      
      renderSalesTable();
      renderPurchaseTable();
      renderExpenseTable();
    }

    function toggleCapitalEdit() {
      const displaySection = document.getElementById('capitalDisplaySection');
      const editSection = document.getElementById('capitalEditSection');
      
      if (editSection.classList.contains('hidden')) {
        editSection.classList.remove('hidden');
        displaySection.classList.add('hidden');
        
        const capital = getCapital();
        document.getElementById('capitalInput').value = capital;
      } else {
        editSection.classList.add('hidden');
        displaySection.classList.remove('hidden');
      }
    }

    async function saveCapital(event) {
      event.preventDefault();
      
      const amount = parseInt(document.getElementById('capitalInput').value) || 0;
      
      if (!currentUser) return;
      
      try {
        await window.firebaseModules.setDoc(
          window.firebaseModules.doc(window.firebaseModules.db, 'capitals', currentUser.uid),
          {
            amount,
            timestamp: window.firebaseModules.serverTimestamp()
          }
        );
        
        loadCapital();
        calculateIncomeStatement();
        toggleCapitalEdit();
        
        showMessage('saleMessage', translations[currentLanguage].capitalSaved, 'success');
        setTimeout(() => hideMessage('saleMessage'), 2000);
      } catch (error) {
        console.error("Error saving capital:", error);
        showMessage('saleMessage', 'Error: ' + error.message, 'error');
      }
    }

    async function loadCapital() {
      if (!currentUser) return;
      
      try {
        const capitalDoc = await window.firebaseModules.getDoc(
          window.firebaseModules.doc(window.firebaseModules.db, 'capitals', currentUser.uid)
        );
        const capital = capitalDoc.exists() ? capitalDoc.data().amount : 0;
        document.getElementById('displayCapital').textContent = formatCurrency(capital);
      } catch (error) {
        console.error("Error loading capital:", error);
      }
    }

    function calculateIncomeStatement() {
      const capital = getCapital();
      const sales = allData.filter(d => d.type === 'sale');
      const purchases = allData.filter(d => d.type === 'purchase');
      const expenses = allData.filter(d => d.type === 'expense');
      
      const revenue = sales.reduce((sum, sale) => sum + sale.total, 0);
      const cogs = purchases.reduce((sum, purchase) => sum + purchase.total, 0);
      const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
      const grossProfit = revenue - cogs;
      const netProfit = grossProfit - totalExpenses;
      
      document.getElementById('displayCapital').textContent = formatCurrency(capital);
      document.getElementById('displayRevenue').textContent = formatCurrency(revenue);
      document.getElementById('displayCOGS').textContent = formatCurrency(cogs);
      document.getElementById('displayGrossProfit').textContent = formatCurrency(grossProfit);
      document.getElementById('displayExpenses').textContent = formatCurrency(totalExpenses);
      document.getElementById('displayNetProfit').textContent = formatCurrency(netProfit);
      
      const grossProfitCard = document.getElementById('displayGrossProfit').closest('.summary-card');
      const netProfitCard = document.getElementById('displayNetProfit').closest('.summary-card');
      
      grossProfitCard.classList.remove('positive', 'negative');
      netProfitCard.classList.remove('positive', 'negative');
      
      if (grossProfit > 0) grossProfitCard.classList.add('positive');
      else if (grossProfit < 0) grossProfitCard.classList.add('negative');
      
      if (netProfit > 0) netProfitCard.classList.add('positive');
      else if (netProfit < 0) netProfitCard.classList.add('negative');
      
      renderDetailReport(capital, revenue, cogs, grossProfit, totalExpenses, netProfit);
    }

    function getCapital() {
      if (!currentUser) return 0;
      const capitalDoc = allData.find(d => d.type === 'capital');
      return capitalDoc ? capitalDoc.amount : 0;
    }

    function renderDetailReport(capital, revenue, cogs, grossProfit, totalExpenses, netProfit) {
      const t = translations[currentLanguage];
      const tbody = document.getElementById('reportTableBody');
      
      tbody.innerHTML = `
        <tr style="background: rgba(255,255,255,0.05);">
          <td style="font-weight: 600;">${t.capitalTitle}</td>
          <td style="font-weight: 600;">${formatCurrency(capital)}</td>
        </tr>
        <tr>
          <td style="font-weight: 600;">${t.revenue}</td>
          <td style="font-weight: 600;">${formatCurrency(revenue)}</td>
        </tr>
        <tr>
          <td>${t.cogs}</td>
          <td>(${formatCurrency(cogs)})</td>
        </tr>
        <tr style="background: rgba(255,255,255,0.1);">
          <td style="font-weight: 600;">${t.grossProfit}</td>
          <td style="font-weight: 600;">${formatCurrency(grossProfit)}</td>
        </tr>
        <tr>
          <td>${t.expenses}</td>
          <td>(${formatCurrency(totalExpenses)})</td>
        </tr>
        <tr style="background: rgba(255,255,255,0.15);">
          <td style="font-weight: 700; font-size: 16px;">${t.netProfit}</td>
          <td style="font-weight: 700; font-size: 16px; color: ${netProfit >= 0 ? '#38ef7d' : '#f5576c'};">${formatCurrency(netProfit)}</td>
        </tr>
      `;
    }

    function formatCurrency(amount) {
      return 'Rp ' + amount.toLocaleString('id-ID');
    }

    function showMessage(elementId, message, type) {
      const msgElement = document.getElementById(elementId);
      msgElement.textContent = message;
      msgElement.className = `message ${type} show`;
    }

    function hideMessage(elementId) {
      const msgElement = document.getElementById(elementId);
      msgElement.classList.remove('show');
    }
  </script>
</body>
</html>